# BTC期权防御策略量化分析系统

## 功能概述

这是一个专业的Python期权防御策略量化分析系统，专门用于分析BTC期权数据并生成防御策略评估报告。系统能够：

- 自动读取多个到期日的BTC期权CSV数据文件
- 计算关键的风险指标和性价比指标
- 分析三种单腿看跌期权策略：全面保护、部分保护、尾部对冲
- 分析熊市看跌价差策略
- 生成详细的分析报告、可视化图表和综合报告文档
- 提供最优策略推荐和原因分析

## 安装依赖

```bash
pip install -r requirements.txt
```

## 程序逻辑

### 核心分析流程

1. **数据加载与预处理**
   - 自动扫描`data/`文件夹中的CSV文件
   - 解析期权代码，提取到期日、行权价、期权类型
   - 计算中间价、隐含波动率等关键指标
   - 筛选看跌期权数据

2. **性价比指标计算**
   - **Vega/Theta比率**: 衡量波动率收益与时间成本的平衡
   - **隐含波动率**: 基于中间价计算的期权隐含波动率
   - **到期天数**: 距离到期的时间

3. **策略分析**
   - **单腿策略**: 按Delta范围分类分析三种保护策略
   - **价差策略**: 构建熊市看跌价差组合，计算盈亏比
   - **最优选择**: 基于性价比指标排序推荐

4. **报告生成**
   - 控制台输出详细分析报告
   - 生成CSV数据文件
   - 创建可视化图表
   - 生成综合Markdown报告

## 使用方法

### 1. 准备数据文件

将包含期权数据的CSV文件放置在 `data/` 文件夹中。CSV文件应包含以下列：

- **产品**: 期权代码（如 BTC-26DEC25-65000-P）
- **买价、卖价**: 期权买卖价格
- **Δ|增量**: Delta值
- **Gamma、Theta、Vega**: 希腊字母
- **IV 报价、IV 询价**: 隐含波动率

### 2. 运行分析

#### 方法一：使用主程序
```bash
python put2.py
```

#### 方法二：使用测试脚本（推荐）
```bash
python test_put2.py
```

测试脚本使用预设的现货价格（$65,000），无需手动输入。

### 3. 查看结果

分析完成后，结果将保存在 `export/` 文件夹中：

#### 数据文件
- **`options_analysis_*.csv`**: 完整期权数据和分析结果
- **`full_protection_put_*.csv`**: 全面保护策略结果
- **`partial_protection_put_*.csv`**: 部分保护策略结果
- **`tail_hedge_put_*.csv`**: 尾部对冲策略结果
- **`bear_put_spread_*.csv`**: 熊市看跌价差策略结果

#### 可视化图表
- **`iv_smile_*.png`**: 隐含波动率微笑图
- **`vega_theta_ratio_*.png`**: Vega/Theta性价比曲线图
- **`payoff_diagram_*.png`**: 最优价差策略盈亏图

#### 综合报告
- **`comprehensive_report_*.md`**: 完整的策略分析报告（新增）

## 策略说明

### 单腿看跌期权策略

1. **全面保护策略** (Delta: -0.55 到 -0.45)
   - 适合预期大幅下跌的投资者
   - 提供强保护但成本较高
   - 按Vega/Theta比率排序

2. **部分保护策略** (Delta: -0.35 到 -0.25)
   - 适合预期中等下跌的投资者
   - 平衡保护效果与成本
   - 按Vega/Theta比率排序

3. **尾部对冲策略** (Delta: -0.15 到 -0.05)
   - 适合长期持有者
   - 提供极端情况下的保护
   - 按Vega/Theta比率排序

### 熊市看跌价差策略

- **长腿Delta范围**: -0.40 到 -0.30
- **短腿Delta范围**: -0.15 到 -0.10
- **筛选条件**: 净权利金 > 0，盈亏比 > 1.5
- **排序方式**: 按盈亏比降序排列
- **优势**: 大幅降低权利金成本，风险可控

## 配置选项

在脚本顶部的配置区域，您可以修改：

- **`DATA_FOLDER`**: 数据文件夹路径（默认: 'data'）
- **`SPOT_PRICE`**: 现货价格（设为None时运行时输入）
- **`STRATEGY_CONFIG`**: 策略筛选标准
- **`OUTPUT_FOLDER`**: 输出文件夹（默认: 'export'）

### 策略配置参数

```python
STRATEGY_CONFIG = {
    'full_protection_put': {'delta_min': -0.55, 'delta_max': -0.45},
    'partial_protection_put': {'delta_min': -0.35, 'delta_max': -0.25},
    'tail_hedge_put': {'delta_min': -0.15, 'delta_max': -0.05},
    'bear_put_spread': {
        'long_delta_min': -0.40, 'long_delta_max': -0.30,
        'short_delta_min': -0.15, 'short_delta_max': -0.10,
        'min_reward_risk_ratio': 1.5
    }
}
```

## 输出示例

### 控制台输出
脚本会在控制台输出详细的分析报告，包括：

- 分析日期和标的现货价格
- 各到期日的策略分析结果
- 最优期权推荐和关键指标
- 价差策略组合分析

### 综合报告内容
生成的Markdown报告包含：

1. **市场概况**: 分析日期、现货价格、期权数量、到期日范围
2. **策略分析结果**: 按到期日分组的详细策略分析
3. **最优策略推荐**: 基于量化指标的最优策略选择
4. **市场环境分析**: 波动率水平、时间价值、策略建议
5. **风险提示**: 时间价值衰减、波动率风险、流动性风险等
6. **使用建议**: 不同策略的适用场景和组合建议

### 数据文件结构

#### 期权分析数据 (options_analysis_*.csv)
- 期权基本信息：产品代码、到期日、行权价、期权类型
- 价格数据：买价、卖价、中间价
- 希腊字母：Delta、Gamma、Theta、Vega
- 分析指标：隐含波动率、到期天数、Vega/Theta比率

#### 策略结果数据 (*_strategy_*.csv)
- 筛选后的期权数据
- 按策略类型分类
- 按性价比指标排序

#### 价差策略数据 (bear_put_spread_*.csv)
- 长腿和短腿期权信息
- 净权利金、最大风险、最大利润
- 盈亏平衡点、盈亏比

## 文件结构

```
put2/
├── data/                          # 数据文件夹
│   ├── BTC-26DEC25-export.csv    # 期权数据文件
│   ├── BTC-27MAR26-export.csv
│   └── BTC-28NOV25-export.csv
├── export/                        # 输出文件夹
│   ├── comprehensive_report_*.md  # 综合报告
│   ├── options_analysis_*.csv     # 完整期权数据
│   ├── *_strategy_*.csv          # 各策略结果
│   ├── iv_smile_*.png            # 波动率微笑图
│   ├── vega_theta_ratio_*.png    # 性价比曲线图
│   └── payoff_diagram_*.png      # 盈亏图
├── put2.py                       # 主程序
├── test_put2.py                  # 测试脚本
├── requirements.txt              # 依赖包
└── README.md                     # 说明文档
```

## 注意事项

- 确保CSV文件格式正确，包含必要的列
- 脚本只分析看跌期权（P类型）
- 建议在运行前备份重要数据
- 图表显示需要图形界面支持
- 综合报告使用Markdown格式，可用任何文本编辑器查看

## 技术支持

如有问题，请检查：
1. 数据文件格式是否正确
2. 依赖包是否完整安装
3. 文件路径是否正确设置
4. 现货价格是否合理设置

## 更新日志

### v2.0 (最新)
- 新增综合报告文档生成功能
- 添加最优策略推荐和原因分析
- 优化报告格式和可读性
- 增加市场环境分析
- 完善风险提示和使用建议
