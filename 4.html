<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel Art Generator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 20px;
      }
      #pixel-art {
        display: grid;
        gap: 0;
        margin: 20px auto;
      }
      .pixel {
        width: 5px;
        height: 5px;
      }
      #size-slider {
        width: 80%;
        margin: 20px auto;
      }
    </style>
  </head>
  <body>
    <h1>上传图片并生成像素艺术</h1>
    <input type="file" id="image-upload" accept="image/*" />
    <label for="size-slider">调整图片大小：</label>
    <input type="range" id="size-slider" min="10" max="200" value="100" />
    <div id="pixel-art"></div>

    <script>
      document
        .getElementById("image-upload")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (!file) return;

          // 创建 FileReader 对象读取图片文件
          const reader = new FileReader();
          reader.onload = function (e) {
            const img = new Image();
            img.src = e.target.result;

            img.onload = function () {
              renderImage(img);
            };
          };
          reader.readAsDataURL(file);
        });

      // 渲染图片并支持动态调整大小
      function renderImage(img) {
        const slider = document.getElementById("size-slider");
        const pixelArtContainer = document.getElementById("pixel-art");

        function updatePixelArt() {
          const scale = slider.value / 100; // 获取缩放比例
          const scaledWidth = Math.floor(img.width * scale);
          const scaledHeight = Math.floor(img.height * scale);

          // 使用 Canvas 获取图片像素数据
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");

          // 设置 Canvas 尺寸与缩放后的图片一致
          canvas.width = scaledWidth;
          canvas.height = scaledHeight;
          ctx.drawImage(img, 0, 0, scaledWidth, scaledHeight);

          // 获取像素数据
          const imageData = ctx.getImageData(0, 0, scaledWidth, scaledHeight);
          const pixels = imageData.data; // RGBA 数组

          // 渲染像素到页面
          renderPixels(pixels, scaledWidth, scaledHeight);
        }

        // 初始渲染
        updatePixelArt();

        // 监听滑块变化
        slider.addEventListener("input", updatePixelArt);
      }

      // 渲染像素为 DIV
      function renderPixels(pixels, width, height) {
        const pixelArtContainer = document.getElementById("pixel-art");
        pixelArtContainer.innerHTML = ""; // 清空容器

        // 设置 Grid 布局
        pixelArtContainer.style.gridTemplateColumns = `repeat(${width}, 1fr)`;
        pixelArtContainer.style.gridTemplateRows = `repeat(${height}, 1fr)`;

        // 遍历每个像素
        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            const index = (y * width + x) * 4; // 每个像素占 4 个字节（RGBA）
            const r = pixels[index];
            const g = pixels[index + 1];
            const b = pixels[index + 2];
            const a = pixels[index + 3];

            // 创建 div 并设置颜色
            const pixelDiv = document.createElement("div");
            pixelDiv.className = "pixel";
            pixelDiv.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${
              a / 255
            })`;
            pixelArtContainer.appendChild(pixelDiv);
          }
        }
      }
    </script>
  </body>
</html>
